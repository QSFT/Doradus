<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <title>Multi-level Grouping</title>
    <link rel="StyleSheet" href="css/Doradus%20Spider%20Database%20-%20v2.3.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="Doradus%20Spider%20Database%20-%20v2.3.1.086.html">Spider Aggregate Queries</a> : <a class="WebWorks_Breadcrumb_Link" href="Doradus%20Spider%20Database%20-%20v2.3.1.089.html">Grouping Parameter</a> : Multi-level Grouping</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading_3"><a name="pID0E0PJB0HA">Multi-level Grouping</a></div>
      <div class="Normal"><a name="pID0E0OJB0HA">The grouping parameter can list multiple grouping expressions to form multi-level grouping. Each grouping expression must be a </a><span style="font-style: italic">path</span> from the perspective table to a link or scalar field. Below is an example multi-level aggregate query:</div>
      <div class="Code"><a name="pID0E0NJB0HA">GET /Msgs/Message/_aggregate?m=COUNT(*)&amp;f=TRUNCATE(SendDate,DAY),Tags</a></div>
      <div class="Normal"><a name="pID0E0MJB0HA">In this example, </a><span class="Code_Char">TRUNCATE(SendDate,DAY)</span> is the top-level grouping field and <span class="Code_Char">Tags</span> is the second-level grouping field. The query creates groups based on the cross-product of all grouping field values, and a metric is computed for each combination for which at least one object has a value. A perspective object is included in the metric computation for each group for which it has actual values. A <span class="Code_Char">summary</span> value is computed for each non-leaf group, and a <span class="Code_Char">totalobjects</span> value is computed for the top-level group. An example result in XML is shown below:</div>
      <div class="Code"><a name="pID0E0LJB0HA">&lt;results&gt;</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0KJB0HA">&lt;aggregate metric="COUNT(*)" group="TRUNCATE(SendDate,DAY),Tags"/&gt;</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0JJB0HA">&lt;</a><span style="color: #3366FF">totalobjects</span>&gt;6030&lt;/totalobjects&gt;</div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0IJB0HA">&lt;</a><span style="color: #008000">summary</span>&gt;6030&lt;/summary&gt;</div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0HJB0HA">&lt;groups&gt;</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E0GJB0HA">&lt;group&gt;</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0FJB0HA">&lt;</a><span style="color: #008000">summary</span>&gt;4752&lt;/summary&gt;</div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0EJB0HA">&lt;field name="SendDate"&gt;2010-07-17 00:00:00&lt;/field&gt;</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0DJB0HA">&lt;groups&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0CJB0HA">&lt;group&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0BJB0HA">&lt;metric&gt;1&lt;/metric&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0AJB0HA">&lt;field name="Tags"&gt;(null)&lt;/field&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E06IB0HA">&lt;/group&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E05IB0HA">&lt;group&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E04IB0HA">&lt;metric&gt;4751&lt;/metric&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E03IB0HA">&lt;field name="Tags"&gt;AfterHours&lt;/field&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E02IB0HA">&lt;/group&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E01IB0HA">&lt;group&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0ZIB0HA">&lt;metric&gt;1524&lt;/metric&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0YIB0HA">&lt;field name="Tags"&gt;Customer&lt;/field&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0XIB0HA">&lt;/group&gt;</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0WIB0HA">&lt;/groups&gt;</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E0VIB0HA">&lt;/group&gt;</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E0UIB0HA">&lt;group&gt;</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0TIB0HA">&lt;</a><span style="color: #008000">summary</span>&gt;1278&lt;/summary&gt;</div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0SIB0HA">&lt;field name="SendDate"&gt;2010-07-18 00:00:00&lt;/field&gt;</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0RIB0HA">&lt;groups&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0QIB0HA">&lt;group&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0PIB0HA">&lt;metric&gt;1278&lt;/metric&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0OIB0HA">&lt;field name="Tags"&gt;AfterHours&lt;/field&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0NIB0HA">&lt;/group&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0MIB0HA">&lt;group&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0LIB0HA">&lt;metric&gt;700&lt;/metric&gt;</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0KIB0HA">&lt;field name="Tags"&gt;Customer&lt;/field&gt;</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0JIB0HA">&lt;/group&gt;</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0IIB0HA">&lt;/groups&gt;</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E0HIB0HA">&lt;/group&gt;</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0GIB0HA">&lt;/groups&gt;</a></div>
      <div class="Code"><a name="pID0E0FIB0HA">&lt;/results&gt;</a></div>
      <div class="Normal"><a name="pID0E0EIB0HA">The same response in JSON:</a></div>
      <div class="Code"><a name="pID0E0DIB0HA">{"results": {</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0CIB0HA">"aggregate": {"metric": "COUNT(*)", "group": "TRUNCATE(SendDate,DAY),Tags"},</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0BIB0HA">"</a><span style="color: #3366FF">totalobjects</span>": "6030",</div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0AIB0HA">"</a><span style="color: #008000">summary</span>": "6030",</div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E06HB0HA">"groups": [</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E05HB0HA">{"group": {</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E04HB0HA">"</a><span style="color: #008000">summary</span>": "4752",</div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E03HB0HA">"field": {"SendDate":"2010-07-17 00:00:00"},</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E02HB0HA">"groups": [</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E01HB0HA">{"group": {</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0ZHB0HA">"metric": "1",</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0YHB0HA">"field": {"Tags": "(null)"}</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0XHB0HA">}},</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0WHB0HA">{"group": {</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0VHB0HA">"metric": "4751",</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0UHB0HA">"field": {"Tags":"AfterHours"}</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0THB0HA">}},</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0SHB0HA">{"group": {</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0RHB0HA">"metric": "1524",</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0QHB0HA">"field": {"Tags":"Customer"}</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0PHB0HA">}}</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0OHB0HA">]</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E0NHB0HA">}},</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E0MHB0HA">{"group": {</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0LHB0HA">"</a><span style="color: #008000">summary</span>": "1278",</div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0KHB0HA">"field": {"SendDate": "2010-07-18 00:00:00"},</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0JHB0HA">"groups": [</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0IHB0HA">{"group": {</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0HHB0HA">"metric": "1278",</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0GHB0HA">"field": {"Tags":"AfterHours"}</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0FHB0HA">}},</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0EHB0HA">{"group": {</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0DHB0HA">"metric": "700",</a></div>
      <div class="Code" style="margin-left: 108pt"><a name="pID0E0CHB0HA">"field": {"Tags":"Customer"}</a></div>
      <div class="Code" style="margin-left: 90pt"><a name="pID0E0BHB0HA">}}</a></div>
      <div class="Code" style="margin-left: 72pt"><a name="pID0E0AHB0HA">]</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E06GB0HA">}}</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E05GB0HA">]</a></div>
      <div class="Code"><a name="pID0E04GB0HA">}}</a></div>
      <div class="Normal"><a name="pID0E03GB0HA">Each non-leaf </a><span class="Code_Char">group</span> has an inner <span class="Code_Char">groups</span> element containing its corresponding lower-level <span class="Code_Char">group</span> elements and a <span class="Code_Char">summary</span> element that provides a group-level metric value. Leaf-level groups have a <span class="Code_Char">metric</span> element. This structure is recursive if there are more than two grouping levels.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>