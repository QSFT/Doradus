<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <title>Multi-metric Aggregate Queries</title>
    <link rel="StyleSheet" href="css/Doradus%20OLAP%20Database%20-%20v2.3.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="Doradus%20OLAP%20Database%20-%20v2.3.1.074.html">OLAP Aggregate Queries</a> : Multi-metric Aggregate Queries</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading_2"><a name="pID0E0GX0HA">Multi-metric Aggregate Queries</a></div>
      <div class="Normal"><a name="pID0E0FX0HA">The metric parameter can use a comma-separated list of metric functions. Such </a><span style="font-style: italic">multi-metric</span> queries perform multiple metric computations in a single pass through the data. The simplest case uses no grouping parameter. For example:</div>
      <div class="Code"><a name="pID0E0EX0HA">.../_aggregate?</a><span style="color: #008000">m=COUNT(*),MAX(Size),AVERAGE(Size)&amp;shards=...</span></div>
      <div class="Normal"><a name="pID0E0DX0HA">This query requests a count of all objects and the maximum and average values for the </a><span class="Code_Char">Size</span> field. Multi-metric query results use an outer <span class="Code_Char">groupsets</span> element containing one <span class="Code_Char">groupset</span> for each metric function. The query above returns results such as the following:</div>
      <div class="Code"><a name="pID0E0CX0HA">&lt;results&gt;</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0BX0HA">&lt;aggregate&nbsp;metric="</a><span style="color: #008000">COUNT(*)</span>,<span style="color: #3366FF">MAX(Size)</span>,<span style="color: #FF6600">AVERAGE(Size)</span>"/&gt;</div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0AX0HA">&lt;groupsets&gt;</a></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #008000"><a name="pID0E06W0HA">&lt;groupset&nbsp;metric="COUNT(*)"&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E05W0HA">&lt;value&gt;6030&lt;/value&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #008000"><a name="pID0E04W0HA">&lt;/groupset&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #3366FF"><a name="pID0E03W0HA">&lt;groupset&nbsp;metric="MAX(Size)"&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E02W0HA">&lt;value&gt;16796009&lt;/value&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #3366FF"><a name="pID0E01W0HA">&lt;/groupset&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #FF6600"><a name="pID0E0ZW0HA">&lt;groupset&nbsp;metric="AVERAGE(Size)"&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0YW0HA">&lt;value&gt;31615.808&lt;/value&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #FF6600"><a name="pID0E0XW0HA">&lt;/groupset&gt;</a></span></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0WW0HA">&lt;/groupsets&gt;</a></div>
      <div class="Code"><a name="pID0E0VW0HA">&lt;/results&gt;</a></div>
      <div class="Normal"><a name="pID0E0UW0HA">In JSON:</a></div>
      <div class="Code"><a name="pID0E0TW0HA">{"results": {</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0SW0HA">"aggregate": {"metric": "</a><span style="color: #008000">COUNT(*)</span>,<span style="color: #3366FF">MAX(Size)</span>,<span style="color: #FF6600">AVERAGE(Size)</span>"},</div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0RW0HA">"groupsets": [</a></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #008000"><a name="pID0E0QW0HA">{"groupset": {</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0PW0HA">"metric": "COUNT(*)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0OW0HA">"value": "6030"</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #008000"><a name="pID0E0NW0HA">}},</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #3366FF"><a name="pID0E0MW0HA">{"groupset": {</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0LW0HA">"metric": "MAX(Size)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0KW0HA">"value": "16796009"</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #3366FF"><a name="pID0E0JW0HA">}},</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #FF6600"><a name="pID0E0IW0HA">{"groupset": {</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0HW0HA">"metric": "AVERAGE(Size)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0GW0HA">"value": "31615.808"</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #FF6600"><a name="pID0E0FW0HA">}}</a></span></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0EW0HA">]</a></div>
      <div class="Code"><a name="pID0E0DW0HA">}}</a></div>
      <div class="Normal"><a name="pID0E0CW0HA">As shown, one </a><span class="Code_Char">groupset</span> is provided for each metric function. Since there is no grouping parameter, the format of each <span class="Code_Char">groupset</span> matches that of a global aggregate query: a <span class="Code_Char">metric</span> element identifies which metric function is computed, and a <span class="Code_Char">value</span> element provides the function’s value.</div>
      <div class="Normal"><a name="pID0E0BW0HA">For grouped, multi-metric aggregate queries, each metric function is computed for all inner and outer group levels. Any mix of metric functions can be used except for the </a><span class="Code_Char">DISTINCT</span> function, which cannot be used in a multi-metric queries. Grouped queries produce one <span class="Code_Char">groupset</span> result for each metric function as in the non-grouped case. However, each <span class="Code_Char">groupset</span> will contain groups that decompose the metric computations in the appropriate groups.</div>
      <div class="Normal"><a name="pID0E0AW0HA">When a multi-metric aggregate query uses the </a><span class="Code_Char">TOP</span> or <span class="Code_Char">BOTTOM</span> function in the outer grouping field, the <span class="Code_Char">TOP</span> or <span class="Code_Char">BOTTOM</span> limit is derived from the <span style="text-decoration: underline">first</span> metric function. The outer and inner groups are selected on this metric function, and each metric function is performed for those groups. For example:</div>
      <div class="Code"><a name="pID0E06V0HA">.../_aggregate?</a><span style="color: #008000">m=COUNT(*),MAX(Size),AVERAGE(Size)</span>&amp;f=TOP(2,Tags),TRUNCATE(SendDate,MONTH)&amp;shards=...</div>
      <div class="Normal"><a name="pID0E05V0HA">The </a><span class="Code_Char">COUNT(*)</span> metric determines which outer groups are included in the <span class="Code_Char">TOP(2)</span> grouping; the <span class="Code_Char">COUNT(*)</span>, <span class="Code_Char">MAX(Size)</span>, and <span class="Code_Char">AVERAGE(Size)</span> functions are returned for all these 2 outer groups and the corresponding inner groups. A typical response to the query above in XML:</div>
      <div class="Code"><a name="pID0E04V0HA">&lt;results&gt;</a></div>
      <div class="Code" style="margin-left: 54pt; text-indent: -18pt"><a name="pID0E03V0HA">&lt;aggregate&nbsp;metric="</a><span style="color: #008000">COUNT(*)</span>,<span style="color: #FF6600">MAX(Size)</span>,<span style="color: #3366FF">AVERAGE(Size)</span>"<br />group="TOP(2,Tags),TRUNCATE(SendDate,MONTH)"/&gt;</div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E02V0HA">&lt;groupsets&gt;</a></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #008000"><a name="pID0E01V0HA">&lt;groupset group="TOP(2,Tags),TRUNCATE(SendDate,MONTH)" metric="COUNT(*)"&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0ZV0HA">&lt;summary&gt;6030&lt;/summary&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0YV0HA">&lt;totalgroups&gt;3&lt;/totalgroups&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0XV0HA">&lt;groups&gt;</a></span></div>
      <div class="Code" style="margin-left: 90pt"><span style="color: #008000"><a name="pID0E0WV0HA">...</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0VV0HA">&lt;/groups&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #008000"><a name="pID0E0UV0HA">&lt;/groupset&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #FF6600"><a name="pID0E0TV0HA">&lt;groupset group="TOP(2,Tags),TRUNCATE(SendDate,MONTH)" metric="MAX(Size)"&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0SV0HA">&lt;summary&gt;16796009&lt;/summary&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0RV0HA">&lt;totalgroups&gt;3&lt;/totalgroups&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0QV0HA">&lt;groups&gt;</a></span></div>
      <div class="Code" style="margin-left: 90pt"><span style="color: #FF6600"><a name="pID0E0PV0HA">...</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0OV0HA">&lt;/groups&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #FF6600"><a name="pID0E0NV0HA">&lt;/groupset&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #3366FF"><a name="pID0E0MV0HA">&lt;groupset group="TOP(2,Tags),TRUNCATE(SendDate,MONTH)" metric="AVERAGE(Size)"&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0LV0HA">&lt;summary&gt;31615.808&lt;/summary&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0KV0HA">&lt;totalgroups&gt;3&lt;/totalgroups&gt;</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0JV0HA">&lt;groups&gt;</a></span></div>
      <div class="Code" style="margin-left: 90pt"><span style="color: #3366FF"><a name="pID0E0IV0HA">...</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0HV0HA">&lt;/groups&gt;</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #3366FF"><a name="pID0E0GV0HA">&lt;/groupset&gt;</a></span></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0FV0HA">&lt;/groupsets&gt;</a></div>
      <div class="Code"><a name="pID0E0EV0HA">&lt;/results&gt;</a></div>
      <div class="Normal"><a name="pID0E0DV0HA">Because the outer grouping level used the </a><span class="Code_Char">TOP</span> function, a <span class="Code_Char">totalgroups</span> value is provided for each outer grouping level. Here’s the same response in JSON:</div>
      <div class="Code"><a name="pID0E0CV0HA">{"results": {</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0BV0HA">"aggregate": {</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E0AV0HA">"group": "TOP(2,Tags),TRUNCATE(SendDate,MONTH)",</a></div>
      <div class="Code" style="margin-left: 54pt"><a name="pID0E06U0HA">"metric": "</a><span style="color: #008000">COUNT(*)</span>,<span style="color: #3366FF">MAX(Size)</span>,<span style="color: #FF6600">AVERAGE(Size)</span>"</div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E05U0HA">},</a></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E04U0HA">"groupsets": [</a></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #008000"><a name="pID0E03U0HA">{"groupset": {</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E02U0HA">"metric": "COUNT(*)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E01U0HA">"group": "TOP(2,Tags),TRUNCATE(SendDate,MONTH)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0ZU0HA">"groups": [</a></span></div>
      <div class="Code" style="margin-left: 90pt"><span style="color: #008000"><a name="pID0E0YU0HA">...</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0XU0HA">],</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0WU0HA">"summary": "6030",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #008000"><a name="pID0E0VU0HA">"totalgroups": "2"</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #008000"><a name="pID0E0UU0HA">}},</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #3366FF"><a name="pID0E0TU0HA">{"groupset": {</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0SU0HA">"metric":&nbsp;"MAX(Size)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0RU0HA">"group": "TOP(2,Tags),TRUNCATE(SendDate,MONTH)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0QU0HA">"groups": [</a></span></div>
      <div class="Code" style="margin-left: 90pt"><span style="color: #3366FF"><a name="pID0E0PU0HA">...</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0OU0HA">],</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0NU0HA">"summary":&nbsp;"16796009",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #3366FF"><a name="pID0E0MU0HA">"totalgroups":&nbsp;"2"</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #3366FF"><a name="pID0E0LU0HA">}},</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #FF6600"><a name="pID0E0KU0HA">{"groupset": {</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0JU0HA">"metric": "AVERAGE(Size)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0IU0HA">"group": "TOP(2,Tags),TRUNCATE(SendDate,MONTH)",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0HU0HA">"groups": [</a></span></div>
      <div class="Code" style="margin-left: 90pt"><span style="color: #FF6600"><a name="pID0E0GU0HA">...</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0FU0HA">],</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0EU0HA">"summary": "31615",</a></span></div>
      <div class="Code" style="margin-left: 72pt"><span style="color: #FF6600"><a name="pID0E0DU0HA">"totalgroups": "2"</a></span></div>
      <div class="Code" style="margin-left: 54pt"><span style="color: #FF6600"><a name="pID0E0CU0HA">}}</a></span></div>
      <div class="Code" style="margin-left: 36pt"><a name="pID0E0BU0HA">]</a></div>
      <div class="Code"><a name="pID0E0AU0HA">}}</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>